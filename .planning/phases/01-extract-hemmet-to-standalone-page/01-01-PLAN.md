---
phase: 01-extract-hemmet-to-standalone-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/components/home/home-settings-client.tsx
  - apps/frontend/components/home/index.ts
  - apps/frontend/app/(main)/hemmet/layout.tsx
  - apps/frontend/app/(main)/hemmet/page.tsx
  - apps/frontend/app/(main)/installningar/hemmet/page.tsx
autonomous: true

must_haves:
  truths:
    - "User navigates to /hemmet/ and sees a standalone Home management page (not inside settings)"
    - "Home page displays household info, members, and invite flow"
    - "Home page has its own auth guard and wider layout (max-w-4xl)"
  artifacts:
    - path: "apps/frontend/app/(main)/hemmet/layout.tsx"
      provides: "Auth guard and max-w-4xl container for home page"
      contains: "max-w-4xl"
    - path: "apps/frontend/app/(main)/hemmet/page.tsx"
      provides: "Server component fetching home data and rendering HomeSettingsClient"
      contains: "HomeSettingsClient"
    - path: "apps/frontend/components/home/home-settings-client.tsx"
      provides: "Client component managing create/join/leave flows (moved from installningar)"
      contains: "HomeSettingsClient"
  key_links:
    - from: "apps/frontend/app/(main)/hemmet/page.tsx"
      to: "apps/frontend/components/home/home-settings-client.tsx"
      via: "import and render"
      pattern: "import.*HomeSettingsClient.*from.*@/components/home"
    - from: "apps/frontend/app/(main)/hemmet/page.tsx"
      to: "PostgREST RPC get_home_info"
      via: "fetch call"
      pattern: "fetch.*rpc/get_home_info"
---

<objective>
Create the standalone `/hemmet/` route by migrating the Home page out of the settings route group.

Purpose: This extracts the Home management feature from being a settings tab to a standalone page, which is the core goal of Phase 1. The home feature is too complex for a settings tab and deserves its own route.

Output: New `/hemmet/` route with layout (auth guard + max-w-4xl container) and page (server component fetching home data). HomeSettingsClient moved to shared components directory. Old settings page updated to import from new location.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-extract-hemmet-to-standalone-page/01-RESEARCH.md

@apps/frontend/app/(main)/installningar/hemmet/page.tsx
@apps/frontend/app/(main)/installningar/hemmet/home-settings-client.tsx
@apps/frontend/app/(main)/installningar/layout.tsx
@apps/frontend/components/home/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move HomeSettingsClient to shared components directory</name>
  <files>
    apps/frontend/components/home/home-settings-client.tsx
    apps/frontend/components/home/index.ts
    apps/frontend/app/(main)/installningar/hemmet/page.tsx
  </files>
  <action>
    1. Copy `apps/frontend/app/(main)/installningar/hemmet/home-settings-client.tsx` to `apps/frontend/components/home/home-settings-client.tsx`. The file content stays identical -- it already imports from `@/components/home` and `@/lib/home-actions` using absolute paths, so no import changes needed inside the component itself.

    2. Add the export to `apps/frontend/components/home/index.ts`:
       Add `export { HomeSettingsClient } from './home-settings-client'` to the barrel file.

    3. Update the import in `apps/frontend/app/(main)/installningar/hemmet/page.tsx`:
       Change `import { HomeSettingsClient } from './home-settings-client'` to `import { HomeSettingsClient } from '@/components/home/home-settings-client'`.
       This keeps the OLD settings page working while we create the new route.

    4. Delete the original file at `apps/frontend/app/(main)/installningar/hemmet/home-settings-client.tsx`.

    Do NOT change any component logic, props, or behavior. This is a pure file move.
  </action>
  <verify>
    Run `pnpm build` from the repo root. Build must pass with zero errors. The existing `/installningar/hemmet` page should still work since we updated its import.
  </verify>
  <done>
    HomeSettingsClient lives at `components/home/home-settings-client.tsx`, is exported from `components/home/index.ts`, and the old settings hemmet page imports from the new location. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create standalone /hemmet/ route with layout and page</name>
  <files>
    apps/frontend/app/(main)/hemmet/layout.tsx
    apps/frontend/app/(main)/hemmet/page.tsx
  </files>
  <action>
    1. Create `apps/frontend/app/(main)/hemmet/layout.tsx`:
       - Server component with auth guard (same pattern as `installningar/layout.tsx`)
       - Import `getSession` from `@/lib/auth` and `redirect` from `next/navigation`
       - If no session, redirect to `/login`
       - Wrap children in `<div className="max-w-4xl mx-auto">` (wider than settings' max-w-2xl because home page has member lists, invite sections that need more space)
       - Do NOT include page title in layout (page.tsx handles it)

       ```typescript
       import { getSession } from '@/lib/auth'
       import { redirect } from 'next/navigation'

       export default async function HomeLayout({
         children,
       }: {
         children: React.ReactNode
       }) {
         const session = await getSession()
         if (!session) {
           redirect('/login')
         }
         return (
           <div className="max-w-4xl mx-auto">
             {children}
           </div>
         )
       }
       ```

    2. Create `apps/frontend/app/(main)/hemmet/page.tsx`:
       - Server component that fetches home data via `get_home_info` RPC (copy data fetching logic from existing `installningar/hemmet/page.tsx`)
       - Import `HomeSettingsClient` from `@/components/home/home-settings-client` (the new location from Task 1)
       - Do NOT import `SettingsViewToggle` -- this is a standalone page, not a settings tab
       - Add page header: h1 "Mitt hem" with description "Hantera ditt hem och medlemmar" using same styling pattern as settings layout (font-heading text-3xl font-bold)
       - Wrap content in `<div className="space-y-8">` (slightly more spacing than settings' space-y-6 for visual breathing room)

       The inline `getHomeInfo()` function should be copied verbatim from the existing page. It fetches from `${env.POSTGREST_URL}/rpc/get_home_info` with POST method, Bearer token auth, no-store cache, and returns the shaped home info object.

    Do NOT modify any data fetching logic. The page should behave identically to the old settings hemmet page, minus the SettingsViewToggle.
  </action>
  <verify>
    Run `pnpm build` from repo root. Build must pass. Then run `pnpm dev` and navigate to `http://localhost:3000/hemmet` -- the page should render the home management UI (or setup wizard if no home exists) with the "Mitt hem" heading.
  </verify>
  <done>
    `/hemmet/` route exists with auth guard layout and server component page. Page displays "Mitt hem" heading and renders HomeSettingsClient with fetched home data. No SettingsViewToggle present. Build passes clean.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes with zero errors
2. `/hemmet/` renders the home management page with "Mitt hem" heading
3. `/hemmet/` requires authentication (redirects to /login when logged out)
4. `/installningar/hemmet` still works (import updated, not deleted)
5. `HomeSettingsClient` is at `components/home/home-settings-client.tsx` and exported from barrel
</verification>

<success_criteria>
- New route `/hemmet/` is functional and renders home management UI
- Auth guard protects the new route
- Layout uses max-w-4xl (wider than settings)
- Page has standalone heading ("Mitt hem"), no SettingsViewToggle
- Old settings page still works via updated import
- Build passes clean
</success_criteria>

<output>
After completion, create `.planning/phases/01-extract-hemmet-to-standalone-page/01-01-SUMMARY.md`
</output>
