---
phase: 03-integration-visual-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/app/(main)/hemmet/layout.tsx
  - apps/frontend/app/(main)/hemmet/page.tsx
  - apps/frontend/app/(main)/hemmet/hushall/page.tsx
  - apps/frontend/app/(main)/hemmet/medlemmar/page.tsx
  - apps/frontend/app/(main)/hemmet/bjud-in/page.tsx
  - apps/frontend/components/hemmet-sidebar.tsx
  - apps/frontend/components/hemmet-pill-nav.tsx
  - apps/frontend/components/home/home-settings.tsx
  - apps/frontend/components/home/home-settings-client.tsx
  - apps/frontend/lib/home-api.ts
autonomous: true

must_haves:
  truths:
    - "Hemmet page shows a vertical sidebar on desktop with links for Hushall, Medlemmar, Bjud in"
    - "On mobile, Hemmet navigation appears as horizontal scrolling pills matching settings pattern"
    - "Active sidebar/pill item is highlighted with a distinct accent color (not bg-warm)"
    - "When user has no household, sidebar is hidden and full-width create/join flow is shown"
    - "Navigating to /hemmet/ redirects to /hemmet/hushall"
    - "Leave household action appears as a small icon/button on the Hushall page instead of a separate danger zone card"
  artifacts:
    - path: "apps/frontend/components/hemmet-sidebar.tsx"
      provides: "Sidebar navigation for Hemmet"
    - path: "apps/frontend/components/hemmet-pill-nav.tsx"
      provides: "Mobile pill navigation for Hemmet"
    - path: "apps/frontend/app/(main)/hemmet/hushall/page.tsx"
      provides: "Household info sub-page"
    - path: "apps/frontend/app/(main)/hemmet/medlemmar/page.tsx"
      provides: "Member list sub-page"
    - path: "apps/frontend/app/(main)/hemmet/bjud-in/page.tsx"
      provides: "Invite sub-page"
  key_links:
    - from: "apps/frontend/app/(main)/hemmet/layout.tsx"
      to: "components/hemmet-sidebar.tsx"
      via: "import and render in grid layout"
    - from: "apps/frontend/app/(main)/hemmet/page.tsx"
      to: "/hemmet/hushall"
      via: "redirect()"
    - from: "apps/frontend/app/(main)/hemmet/layout.tsx"
      to: "home data fetch"
      via: "getHomeInfo() determines sidebar visibility"
---

<objective>
Restructure the Hemmet page from a single-page layout into a sidebar + sub-pages layout matching the settings pattern established in Phase 2.

Purpose: The user specifically requested "Hemmet should be made into a sidebar view as well, and use the same proportions as settings." This creates visual and structural consistency between the two main account management pages.

Output: Hemmet with CSS Grid sidebar layout (desktop), pill navigation (mobile), and three sub-pages (Hushall, Medlemmar, Bjud in). The existing monolithic HomeSettings component is decomposed into route-based pages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Key existing files to reference:
@apps/frontend/app/(main)/installningar/layout.tsx — CSS Grid sidebar pattern to replicate
@apps/frontend/components/settings-sidebar.tsx — Sidebar component pattern to follow
@apps/frontend/components/settings-pill-nav.tsx — Pill nav pattern to follow
@apps/frontend/components/home/home-settings.tsx — Current monolithic component to decompose
@apps/frontend/components/home/home-settings-client.tsx — Client wrapper with home data
@apps/frontend/app/(main)/hemmet/page.tsx — Current page with data fetching
@apps/frontend/app/(main)/hemmet/layout.tsx — Current simple layout to upgrade
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Hemmet sidebar and pill nav components, update layout to CSS Grid</name>
  <files>
    apps/frontend/components/hemmet-sidebar.tsx
    apps/frontend/components/hemmet-pill-nav.tsx
    apps/frontend/app/(main)/hemmet/layout.tsx
    apps/frontend/app/(main)/hemmet/page.tsx
  </files>
  <action>
Create `hemmet-sidebar.tsx` following the exact pattern from `settings-sidebar.tsx`:
- 'use client' component using usePathname() from next/navigation
- Three nav links: { href: '/hemmet/hushall', label: 'Hushall' }, { href: '/hemmet/medlemmar', label: 'Medlemmar' }, { href: '/hemmet/bjud-in', label: 'Bjud in' }
- Use a complementary accent color for active state. Choose `bg-secondary/10 text-secondary font-medium` for active items (green accent, distinct from settings' warm/destructive). The secondary color (#2d6650 green) complements the warm palette.
- Inactive state: `text-muted-foreground hover:bg-muted/50 hover:text-foreground` (same as settings)
- Sticky positioning at top-20, nav with aria-label="Hemmet"
- aria-current="page" on active link
- No danger zone section (leave household is handled inline on Hushall page)

Create `hemmet-pill-nav.tsx` following `settings-pill-nav.tsx` pattern:
- Same three nav items as sidebar
- Active state uses `bg-secondary text-secondary-foreground` (not bg-warm)
- Inactive state matches settings pattern
- aria-current="page" on active

Update `hemmet/layout.tsx`:
- Import HemmetSidebar, HemmetPillNav
- The layout must fetch home data server-side (move getHomeInfo logic here from page.tsx)
- When user has no home: render children in a simple `max-w-4xl mx-auto` wrapper (no sidebar)
- When user has a home: render the CSS Grid layout matching settings exactly:
  - max-w-6xl mx-auto (match settings width, not old max-w-4xl)
  - Page header with h1 "Mitt hem" and description "Hantera ditt hem och medlemmar"
  - grid grid-cols-1 md:grid-cols-[240px_1fr] gap-8
  - Desktop sidebar in `aside` (hidden md:block)
  - Mobile pill nav (md:hidden)
  - Children in `main` with min-w-0
Update `hemmet/page.tsx`:
- Change to a simple redirect: `redirect('/hemmet/hushall')` (since layout handles auth check and sidebar)
- Import redirect from 'next/navigation'

Data flow (MANDATORY approach): Create `apps/frontend/lib/home-api.ts` with a cached `getHomeInfo()` function using React's `cache()` from 'react'. This function fetches home data (home object + userEmail) server-side. Both the layout (for sidebar visibility) and each sub-page call `getHomeInfo()` directly — React's `cache()` deduplicates within a single request, so there are no duplicate fetches. Do NOT pass data through layout props or React context. Each server component independently calls `getHomeInfo()`.
  </action>
  <verify>
- `pnpm build` succeeds without errors
- Navigating to /hemmet/ redirects to /hemmet/hushall
- Desktop shows sidebar with 3 items
- Mobile shows pill navigation
  </verify>
  <done>
Hemmet has a CSS Grid sidebar layout matching settings, with sidebar (desktop) and pills (mobile). The /hemmet/ route redirects to /hemmet/hushall. When user has no household, sidebar is hidden.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Hemmet sub-pages from decomposed HomeSettings</name>
  <files>
    apps/frontend/app/(main)/hemmet/hushall/page.tsx
    apps/frontend/app/(main)/hemmet/medlemmar/page.tsx
    apps/frontend/app/(main)/hemmet/bjud-in/page.tsx
    apps/frontend/components/home/home-settings.tsx
    apps/frontend/components/home/home-settings-client.tsx
  </files>
  <action>
Create three sub-pages that correspond to the three Cards currently in HomeSettings:

**hushall/page.tsx** (Household info):
- Server component that fetches home data using the shared function from Task 1
- If no home, render the HomeSetupWizard (create/join flow) in full width
- If home exists, render a Card with:
  - CardTitle "Hushall" (or just the home name), CardDescription "Namn och grundinformation"
  - HomeNameEditor inside CardContent
  - A small "leave household" button/icon in the CardHeader or after the card content. Use a subtle destructive-styled button with LogOut icon, not a full danger zone card. Example: `<Button variant="ghost" size="sm" className="text-destructive hover:text-destructive hover:bg-destructive/10">` with a LogOut icon and the HomeLeaveDialog triggered on click.
- Wrap client-interactive parts in a client component (e.g., HushallClient or reuse patterns)

**medlemmar/page.tsx** (Members):
- Server component fetching home data
- If no home, redirect to /hemmet/hushall
- Renders a Card with CardTitle "Medlemmar ({count})", CardDescription "Personer som delar detta hem"
- HomeMemberList in CardContent

**bjud-in/page.tsx** (Invitations):
- Server component fetching home data
- If no home, redirect to /hemmet/hushall
- Renders a Card with CardTitle "Bjud in medlem", CardDescription "Bjud in nya medlemmar via e-post eller delningslänk"
- HomeInviteSection in CardContent

Client wrappers (MANDATORY approach): Create individual client wrappers for each sub-page — `HushallClient`, `MedlemmarClient`, and `BjudInClient` — as the three pages have different interaction patterns (name editing vs member management vs invitations). Each wrapper takes initial data as props and handles mutations with `router.refresh()`. Place these as co-located files or in `components/home/`.

Deprecation of old components (MANDATORY approach): Add a deprecation comment to the top of `home-settings.tsx`: `// @deprecated — Replaced by /hemmet/hushall, /hemmet/medlemmar, /hemmet/bjud-in sub-pages (Phase 03). Remove in future cleanup.` Do NOT delete the file. Stop importing it from the hemmet pages. The `HomeSettingsClient` in `home-settings-client.tsx` is no longer used by the new routing — add the same deprecation comment to it as well.

IMPORTANT: Preserve ALL existing functionality — name editing, member management (list + remove), invite (join codes + email), and leave household MUST all work.
  </action>
  <verify>
- `pnpm build` succeeds
- Each sub-page renders its respective Card content
- Creating/editing home name works on /hemmet/hushall
- Member list shows on /hemmet/medlemmar
- Invite section works on /hemmet/bjud-in
- Leave household works from /hemmet/hushall
  </verify>
  <done>
Hemmet is fully decomposed into three sub-pages matching the sidebar navigation. All existing functionality (name editing, member management, invites, leave) works from the appropriate sub-page.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes
2. Navigate to /hemmet/ — redirects to /hemmet/hushall
3. Desktop: sidebar visible with 3 links, active link highlighted in green accent
4. Mobile: pill navigation visible, active pill highlighted
5. /hemmet/hushall — shows home name editor and leave button
6. /hemmet/medlemmar — shows member list
7. /hemmet/bjud-in — shows invite section (join code + email)
8. User without household: sees create/join wizard at /hemmet/hushall, no sidebar
9. Sidebar width is 240px matching settings
</verification>

<success_criteria>
- Hemmet has sidebar + sub-pages layout structurally matching settings
- All home management functionality preserved and working
- No build errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-visual-polish/03-01-SUMMARY.md`
</output>
