---
phase: 03-integration-visual-polish
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - apps/frontend/components/settings-pill-nav.tsx
  - apps/frontend/components/hemmet-pill-nav.tsx
autonomous: false

must_haves:
  truths:
    - "Mobile pill navigation on both settings and Hemmet shows scroll fade indicators when content overflows"
    - "Scroll fade indicators are NOT visible when pills fit without scrolling"
    - "All existing test suites pass (pnpm test --run)"
    - "Full navigation loop works: header dropdown -> settings -> switch sections -> back to header -> Hemmet -> back"
  artifacts:
    - path: "apps/frontend/components/settings-pill-nav.tsx"
      provides: "Settings pill nav with scroll fade indicators"
    - path: "apps/frontend/components/hemmet-pill-nav.tsx"
      provides: "Hemmet pill nav with scroll fade indicators"
  key_links:
    - from: "settings-pill-nav.tsx"
      to: "Tailwind mask-x utilities"
      via: "conditional className with overflow detection"
    - from: "hemmet-pill-nav.tsx"
      to: "Tailwind mask-x utilities"
      via: "conditional className with overflow detection"
---

<objective>
Add scroll fade indicators to mobile pill navigation on both pages, run tests to verify no regressions, and verify the full cross-page navigation flow.

Purpose: The user requested "Add some kind of shadow/fade interaction on the sides that indicates that you can scroll. Only show it when you can actually scroll." This plan implements smart scroll fades using Tailwind v4.1 mask utilities and verifies the complete integration.

Output: Both pill navs have conditional scroll fade indicators. All tests pass. Full navigation loop verified.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-visual-polish/03-01-SUMMARY.md
@.planning/phases/03-integration-visual-polish/03-02-SUMMARY.md

Key files:
@apps/frontend/components/settings-pill-nav.tsx
@apps/frontend/components/hemmet-pill-nav.tsx (created in plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll fade indicators to both pill navs and run tests</name>
  <files>
    apps/frontend/components/settings-pill-nav.tsx
    apps/frontend/components/hemmet-pill-nav.tsx
  </files>
  <action>
Add smart scroll fade indicators to both pill navigation components. The fade should only appear when content actually overflows (is scrollable).

**Implementation approach - JavaScript overflow detection:**

Both pill nav components need the same enhancement. For each:

1. Add `'use client'` directive (already present on both)
2. Import useRef, useState, useEffect from 'react'
3. Add a ref to the scrollable container: `const scrollRef = useRef<HTMLDivElement>(null)`
4. Add overflow detection state: `const [hasOverflow, setHasOverflow] = useState(false)`
5. Add useEffect to detect overflow:
```tsx
useEffect(() => {
  const el = scrollRef.current
  if (!el) return

  const checkOverflow = () => {
    setHasOverflow(el.scrollWidth > el.clientWidth)
  }

  checkOverflow()
  // Re-check on resize
  const observer = new ResizeObserver(checkOverflow)
  observer.observe(el)
  return () => observer.disconnect()
}, [])
```

6. Apply Tailwind v4.1 mask utilities conditionally on the scrollable div:
```tsx
<div
  ref={scrollRef}
  className={cn(
    'overflow-x-auto',
    hasOverflow && 'mask-x-from-5% mask-x-to-95%'
  )}
>
```

**For settings-pill-nav.tsx:**
- The outer `<nav>` keeps `aria-label="Installningar"`
- The scrollable div gets the ref and conditional mask classes
- Keep existing pill styling and active states unchanged

**For hemmet-pill-nav.tsx:**
- Same pattern as settings
- `aria-label="Hemmet"` on nav
- Scrollable div gets ref and conditional mask

Import `cn` from `@/lib/utils` (already imported in both).

After updating both components, run the full test suite:
```bash
pnpm test --run
pnpm lint
```

Fix any test failures or lint errors. The existing component tests (instruction-editor.test.tsx, search-bar.test.tsx) should not be affected since we're only changing settings/hemmet pill navs which don't have dedicated tests.
  </action>
  <verify>
- `pnpm build` succeeds
- `pnpm test --run` passes all tests
- `pnpm lint` passes
- Both pill navs show fade edges on narrow viewports where pills overflow
- Both pill navs show NO fade on viewports where pills fit
  </verify>
  <done>
Both settings and Hemmet pill navs have smart scroll fade indicators using Tailwind v4.1 mask utilities with JavaScript overflow detection. All tests and lints pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 3 integration: Hemmet restructured with sidebar + sub-pages matching settings, redundant headings removed, card styles unified, scroll fade indicators on mobile pills.
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000 and log in
    2. Click user dropdown in header -> verify both "Mitt hem" and "Installningar" links are visible
    3. Click "Installningar" -> verify sidebar on desktop with Profil/Säkerhet/API-nycklar/Konto
    4. Verify NO redundant h2 headings (only layout h1 + card titles)
    5. Click through all 4 settings sections -> verify Card styling is consistent
    6. Verify profile editing, password change, API key management all work
    7. Click user dropdown -> "Mitt hem" -> verify sidebar with Hushåll/Medlemmar/Bjud in
    8. Verify Hemmet sidebar uses a different accent color from settings
    9. Click through all 3 Hemmet sections -> verify content renders correctly
    10. Verify "leave household" is a small button on Hushåll page (not a full danger card)
    11. Resize to mobile -> verify both pages show pill navigation instead of sidebar
    12. On mobile, verify scroll fade indicators appear when pills overflow
    13. Navigate the full loop: header -> settings -> switch tabs -> header -> hemmet -> header -> back to recipe list
    14. Verify no stale UI or broken active states during navigation
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm build` passes
2. `pnpm test --run` passes
3. `pnpm lint` passes
4. Full navigation loop works without stale UI
5. Both pill navs show conditional scroll fades
6. Visual consistency confirmed across both pages
</verification>

<success_criteria>
- Scroll fade indicators work on both pill navs (only when overflow exists)
- All test suites pass with no regressions
- Human verification confirms complete integration works
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-visual-polish/03-03-SUMMARY.md`
</output>
