---
phase: 05-search-repositioning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/components/search-row.tsx
  - apps/frontend/components/header.tsx
  - apps/frontend/app/(main)/layout.tsx
autonomous: false

must_haves:
  truths:
    - "Search bar appears in a full-width dedicated row below the header row (not inside the header row)"
    - "On desktop, both header row and search row remain visible when scrolling (both sticky)"
    - "On mobile, header row is sticky but search row scrolls away after scrolling down ~50px"
    - "A subtle shadow fades in smoothly below the search row when the page is scrolled"
  artifacts:
    - path: "apps/frontend/components/search-row.tsx"
      provides: "Dedicated search row with sticky behavior, scroll shadow, mobile scroll-away"
      min_lines: 40
    - path: "apps/frontend/components/header.tsx"
      provides: "Header without desktop search bar (search moved to SearchRow)"
    - path: "apps/frontend/app/(main)/layout.tsx"
      provides: "Layout rendering SearchRow between Header and main content"
  key_links:
    - from: "apps/frontend/app/(main)/layout.tsx"
      to: "apps/frontend/components/search-row.tsx"
      via: "import and render between Header and main"
      pattern: "<SearchRow"
    - from: "apps/frontend/components/search-row.tsx"
      to: "apps/frontend/components/search-bar.tsx"
      via: "renders SearchBar inside the row"
      pattern: "<SearchBar"
---

<objective>
Move the search bar from the header row into a dedicated full-width row below the header, implementing stacked sticky positioning on desktop and scroll-away behavior on mobile.

Purpose: The search bar needs more space and prominence. A dedicated row gives it full width and visual separation from navigation. This is the structural repositioning; search bar enhancements come in Plan 02.

Output: SearchRow component, updated header (search removed), updated layout (SearchRow rendered between Header and main).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-search-repositioning/05-CONTEXT.md
@.planning/phases/05-search-repositioning/05-RESEARCH.md
@.planning/phases/04-desktop-header-restructure/04-02-SUMMARY.md
@apps/frontend/components/header.tsx
@apps/frontend/components/search-bar.tsx
@apps/frontend/app/(main)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SearchRow component and rewire header/layout</name>
  <files>
    apps/frontend/components/search-row.tsx
    apps/frontend/components/header.tsx
    apps/frontend/app/(main)/layout.tsx
  </files>
  <action>
Create `apps/frontend/components/search-row.tsx` as a "use client" component:

**SearchRow component:**
- Renders a full-width row below the header containing the SearchBar
- Inner content constrained to same max-width as header (container mx-auto max-w-7xl px-4)
- Vertical padding matching header feel (py-3)
- Subtle top border for visual separation (border-t border-border)
- Background matching header (bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60)

**Desktop sticky behavior (md: breakpoint and above):**
- `md:sticky md:top-16 md:z-40` — sticks below the header (h-16 = top-16)
- Header is already `sticky top-0 z-50`
- Search row stacks below header when scrolled

**Mobile scroll-away behavior (below md: breakpoint):**
- On mobile, the search row is NOT sticky — it scrolls with the page
- Implement scroll direction detection: track `window.scrollY` with a `useRef(lastScrollY)` and a `useState(isHidden)`
- When scrolling DOWN past a 50px threshold: set `isHidden = true`
- When scrolling UP: set `isHidden = false` immediately
- Only apply hide logic on mobile (check `window.innerWidth < 768` inside the scroll handler)
- Use `transition-transform duration-300` for smooth animation
- When hidden on mobile: `-translate-y-full` (slides up out of view)
- On desktop: always `md:translate-y-0` (never hidden)
- IMPORTANT: On mobile, the search row is NOT sticky, so the translate-y hide effect is only useful when it's in viewport near the top. Since it scrolls with content, the hide/show behavior provides a nice transition when user has scrolled back to top. If the user hasn't scrolled much, the row is still visible in normal flow.

**Scroll shadow:**
- Track `isScrolled` state via scroll listener (threshold: `window.scrollY > 10`)
- Apply shadow to search row bottom: `transition-shadow duration-200`
- When scrolled: apply `shadow-md` (on desktop only: `md:shadow-md`)
- Use `{ passive: true }` on addEventListener for performance
- Return cleanup function from useEffect

**Scroll listener implementation:**
- Single useEffect with ONE scroll handler that manages both `isScrolled` and `isHidden` state
- Use `{ passive: true }` option
- Return cleanup function: `return () => window.removeEventListener('scroll', handleScroll)`
- Empty dependency array `[]`

**SearchBar rendering:**
- Wrap `<SearchBar>` in a `<Suspense>` fallback (same pattern as current header)
- SearchBar centered with max-width: wrap in a `<div className="mx-auto max-w-xl">` (gives ~576px max-width, significantly wider than current w-72 = 288px)
- Pass `className="w-full"` to SearchBar

**Update `apps/frontend/components/header.tsx`:**
- Remove the "Desktop Search Bar" section entirely (lines 55-64: the `<div className="hidden md:flex items-center">` wrapping SearchBar with Suspense)
- Remove the `SearchBar` import (it's no longer used in header — mobile search also moves to SearchRow)
- Remove the "Mobile Search Bar" section (lines 102-111: the `<div className="pb-3 md:hidden">` wrapping SearchBar)
- Remove the `Suspense` import if no longer used in header (check if MobileMenu loading still uses it — it does NOT, MobileMenu uses dynamic() with its own loading prop, so Suspense can be removed from header)
- The header `<header>` tag keeps its existing sticky/z-50 classes unchanged

**Update `apps/frontend/app/(main)/layout.tsx`:**
- Import `SearchRow` from `@/components/search-row`
- Render `<SearchRow />` between `<Header />` and `<main>` in the JSX
- The SearchRow sits outside `<main>` as a sibling of Header
- CRITICAL: Ensure no parent element between body and the sticky elements has `overflow: hidden/scroll/auto` — the current layout uses `<div className="flex min-h-screen flex-col">` in root layout which is fine (no overflow set)
  </action>
  <verify>
Run: `.claude/hooks/run-silent.sh "Build" "pnpm build"` and `.claude/hooks/run-silent.sh "Lint" "pnpm lint"`

Both must pass. Verify:
- No TypeScript errors (SearchRow imports, header cleanup)
- No unused import warnings (Suspense, SearchBar removed from header)
- SearchRow component renders SearchBar in a dedicated row
  </verify>
  <done>
- SearchRow component exists with sticky desktop positioning (md:sticky md:top-16 md:z-40)
- Header no longer contains any search bar (desktop or mobile)
- Layout renders SearchRow between Header and main content
- Build and lint pass cleanly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Search bar repositioned from header row to dedicated full-width row below the header. Desktop: both rows sticky. Mobile: search row scrolls away when scrolling down.</what-built>
  <how-to-verify>
1. Open http://localhost:3000 in desktop browser (wider than 768px)
2. Verify search bar appears in its own row below the header (not inside header row)
3. Scroll down — both header row AND search row should remain visible (sticky)
4. Verify a subtle shadow appears below the search row when scrolled
5. Resize browser to mobile width (< 768px)
6. Verify search bar appears below header in normal flow
7. Scroll down slowly — search row should smoothly slide away after ~50px of scrolling
8. Scroll back up — search row should reappear
9. Verify search still works: type a query, press enter, results should load
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- Search bar is NOT in the header row (visually confirmed)
- Desktop: both header and search rows are sticky when scrolling
- Mobile: header is sticky, search row scrolls away
- Shadow appears below search row when page is scrolled
- Existing search functionality preserved (type, submit, navigate to results)
- No `overflow: hidden` on any ancestor of the sticky elements
- Build passes: `pnpm build`
- Lint passes: `pnpm lint`
</verification>

<success_criteria>
SRCH-01 satisfied: Search bar appears in a full-width dedicated row below the header
SRCH-02 satisfied: Both header row and search row are sticky on desktop
SRCH-03 satisfied: Search row is not sticky on mobile (scrolls away)
</success_criteria>

<output>
After completion, create `.planning/phases/05-search-repositioning/05-01-SUMMARY.md`
</output>
